<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.2/css/bootstrap.css'>


    <title>My FAQ's Index</title>

    <!-- STYLESHEETS -->
    <!-- css / materialized website -->
    <!-- http://next.materializecss.com/getting-started.html -->


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body {
            background: url('img/christmas-dark/christmas-dark.png');
            min-height: 100%;
            background-size: fixed;
        }
    </style>

</head>

<body>

    <!-- Navi -->
    <nav>
        <div class="nav-wrapper grey lighten-2">
            <a href="HomePage.html" class="brand-logo teal-text">Logo</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li>
                    <a class="dropdown-button waves-effect waves-light teal-text" data-activates="dropdown1">
                        My Quizz
                        <i class="material-icons right teal-text">arrow_drop_down</i>
                    </a>
                </li>
                <li>
                    <a class="waves-effect waves-light teal-text">My FAQ's</a>
                </li>
                <li>
                    <a class="cmdLogout waves-effect waves-light teal-text">Logout</a>
                </li>
            </ul>

            <ul id="dropdown1" class="dropdown-content">
                <li>
                    <a class="teal-text" href="#!">Quiz one</a>
                </li>
                <li>
                    <a class="teal-text" href="#!">Quiz two</a>
                </li>
                <li>
                    <a class="teal-text" href="#!">Create Quiz</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Body -->
 
   <div class="container FAQs">
    <ul class="collapsible" data-collapsible="accordion">

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>General</div>
            <div id="1" class="collapsible-body">
                
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>VIP</div>
            <div id="2" class="collapsible-body">
                
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>Guard</div>
            <div id="3" class="collapsible-body">
                
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>Security Sepcialist</div>
            <div id="4" class="collapsible-body">
                
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>Financing</div>
            <div id="5"class="collapsible-body ">
               
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>Corporate</div>
            <div id="6" class="collapsible-body">
                
            </div>
        </li>

        <li>
            <div class="collapsible-header">
                <i class="material-icons">place</i>Sepcific Category</div>
            <div id="7" class="collapsible-body">
                
            </div>
        </li>
    </ul>
   </div>

   <div class="container">
       <button id='cmdBack' class="forum waves-effect waves-light btn">Go Back to FAQ's</button>
   </div>





    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>


    <script type="text/javascript">
        sabio.page.startUp = () => {
            sabio.page.handlers.dropdown();
            $('.cmdLogout').on("click", sabio.page.handlers.logout);
            sabio.page.GetAllFAQ(sabio.page.onGetAllSuccess, sabio.page.onError);
            $('#cmdBack').on('click', sabio.page.handlers.goBack);
            $('.FAQs').on('click', '.cmdEdit', sabio.page.handlers.goEdit);
            $('.FAQs').on('click', '.cmdDelete', sabio.page.handlers.Dlt);
        };


        /***** Handler *****/
        sabio.page.handlers.dropdown = () => {
            $('.dropdown-button').dropdown('closed');
        };

        sabio.page.handlers.logout = () => {
            event.preventDefault();
            sabio.page.loggingout(sabio.page.logoutSucess, sabio.page.onError);
        };

        sabio.page.handlers.goBack = () =>{
            window.location.replace("FAQ.html");
        };

        sabio.page.handlers.goEdit = () =>{


        };

        sabio.page.handlers.Dlt = () =>{


        };


        /***** Other *****/
        sabio.page.loadTemplate = () =>{    
            return $($("#template").html());
        };


        /***** Ajax *****/

        sabio.page.loggingout = (onSuccess, onError) => {
            let url = "https://pacoima-ypi.azurewebsites.net/api/users/logout";

            let settings = {
                cache: false,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                dataType: "json",
                xhrFields: {
                    withCredentials: true
                },
                type: "GET",
                success: onSuccess,
                error: onError
            };
            $.ajax(url, settings);
        };

        sabio.page.GetAllFAQ = (onSuccess, onError) =>{
            let url = "https://pacoima-ypi.azurewebsites.net/api/faqs/user";

            let settings = {
                cache: false,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                dataType: "json",
                xhrFields: {
                    withCredentials: true
                },
                type: "GET",
                success: onSuccess,
                error: onError
            };
            $.ajax(url, settings);
        };
        

        /***** Call Back *****/
        sabio.page.onSuccess = () => {
            console.log("success");
        };

        sabio.page.onError = (textStatus) => {
            console.log(textStatus);
            console.log("Too Bad!! Error! :(");
        };

        sabio.page.logoutSucess = () => {
            window.location.replace("login.html");

        };

        sabio.page.onGetAllSuccess = (data) =>{
            let faq = data.items
            faq.sort((a,b) => {
            return a.displayOrder - b.displayOrder;   
            });
            
            for(let i = 0; i < faq.length; i++){
              let userFaqId = faq[i].faqCategoryId;
             
              let temp = sabio.page.loadTemplate();
              $('#userQuestion',temp).text(faq[i].question);
              $('#userAnswer',temp).text(faq[i].answer);
              $('#disOrder',temp).text(faq[i].displayOrder)
              temp.find(".answerTemp").attr("id", faq[i].id);
              $("#" + userFaqId).append(temp);  
            };
        };
        



    </script>

    <!-- Template -->
    <script type="text/template" id="template">

<div class='answerTemp'>
        <span id="userQuestion" class="question white-text"></span>
        <span id="userAnswer" class="answer white-text"></span>
        <span id="disOrder" class="order white-text"></span>
        <button class="cmdEdit waves-effect waves-light orange darken-3">Edit</button>
        <button class="cmdDelete waves-effect waves-light red darken-1">Delete</button>
</div>

    </script>


</body>

</html>